<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간편 영화 후기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
</head>
<body>

    
    <nav class="navbar bg-body-tertiary bg-dark border-bottom border-body" data-bs-theme="dark">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">
            <img src="https://images.unsplash.com/photo-1484903820457-9e585d707e9d?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHx0b3BpYy1mZWVkfDMwfGlVSXNuVnRqQjBZfHxlbnwwfHx8fHw%3D" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
            간편 영화 후기
          </a>
        </div>
      </nav>

      <div class="container">
        <div class="p-5 mb-4 bg-body-tertiary rounded-3" id="jumborton">
            <div class="container-fluid py-5">
              <h1 class="display-5 fw-bold">인기 최신 영화에 한마디씩!</h1>
              <p class="col-md-8 fs-4">Using a series of utilities, you can create this jumbotron, just like the one in previous versions of Bootstrap. Check out the examples below for how you can remix and restyle it to your liking.</p>
              <button class="btn btn-danger btn-lg" type="button">Example button</button>
            </div>
          </div>
          <div class="row row-cols-1 row-cols-md-3 g-4" id="ml">
                
          </div>
      </div>
  
  <!-- Modal -->
  <div class="modal" id="myModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">후기</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          
        </div>
        <div class="modal-footer">
          <input type="text" class="form-control" id="review" style="width: 70%;">
          <button type="button" class="btn btn-primary" onclick="addReview()">후기 쓰기</button>
        </div>
      </div>
    </div>
  </div>

      

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <script>
        let target_id=0;
        
        $(document).ready(function(){

        $.ajax({
            url:"https://api.themoviedb.org/3/movie/popular?api_key=fd9a348ea35bf80a66e691501d1e205e&page=1",
            data:"",
            type:"GET",
            success:function(json){
                console.log(json);
                $("#ml").html('');
                let movie_list = json.results;

                for(let i=0;i<movie_list.length;i++){
                    let card = `<div class="col">
                    <div class="card">
                        <img src="https://image.tmdb.org/t/p/w500/${movie_list[i].poster_path}" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">${movie_list[i].original_title}</h5>
                            <button type="button" class="btn btn-success" id="rbutton" onclick="review(${movie_list[i].id})">리뷰보기</button>
                        </div>
                    </div>
                </div>`

                $("#ml").append(card);
                }
            },
            error:function(err){
                
            },
        })
        })

        function review(id){
            target_id = id;
            $.ajax({
                url:`http://universeapi.net/review/list?movie_id=${id}`,
                data:{},
                type:"GET",
                success:function(json){
                    let reviews  = json.data;
                    $(".modal-body").html("");
                    for(let i=0;i<reviews.length;i++){
                        $(".modal-body").append(`<p>${reviews[i].review}</p>`)
                    }
                },
            })

            $('#myModal').modal('show');
        }

        function addReview(){
            let review = $("#review").val();
            let review_html = `<p>${review}</p>`

            $.ajax({
                url:"http://universeapi.net/review/add",
                data:{
                    movie_ld: target_id,
                    review: review
                },
                type:"POST",
                success:function(json){
                    $(".modal-body").append(review_html);
                }
            })
            
            $("#review").val();
        }
    </script>
</body>
</html>